name: Validate Repository Secrets

on:
  push:
    branches:
      - main
      - sprint-*
  pull_request:
  workflow_dispatch:
  repository_dispatch:
    types: [codex-validate]

permissions:
  contents: read

jobs:
  validate-secrets:
    name: Validate GitHub Actions Secrets
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate required secrets
        run: |
          echo "Validating GitHub repository secrets..."

          REQUIRED_SECRETS=(
            "AUTH_SECRET"
            "AUTH_SALT"
            "DATABASE_URL"
            "ENCRYPTION_KEY"
            "NEXTAUTH_SECRET"
            "NEXTAUTH_URL"
            "JWT_SECRET"
            "GH_TOKEN"
          )

          MISSING=0

          echo ""
          echo "Checking secrets..."
          echo ""

          for SECRET_NAME in "${REQUIRED_SECRETS[@]}"; do
            if [ -z "${!SECRET_NAME}" ]; then
              echo " ‚ùå Missing: $SECRET_NAME"
              MISSING=1
            else
              echo " ‚úÖ Present: $SECRET_NAME"
            fi
          done

          if [ "$MISSING" -eq 1 ]; then
            echo ""
            echo "‚ùå Missing one or more required secrets."
            echo "Add them in Settings ‚Üí Secrets and variables ‚Üí Actions"
            exit 1
          fi

          echo ""
          echo "üéâ All required secrets are present!"
        env:
          AUTH_SECRET: ${{ secrets.AUTH_SECRET }}
          AUTH_SALT: ${{ secrets.AUTH_SALT }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          ENCRYPTION_KEY: ${{ secrets.ENCRYPTION_KEY }}
          NEXTAUTH_SECRET: ${{ secrets.NEXTAUTH_SECRET }}
          NEXTAUTH_URL: ${{ secrets.NEXTAUTH_URL }}
          JWT_SECRET: ${{ secrets.JWT_SECRET }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
