<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SAAS-APP ‚Äî Full Codex + CI Monitoring Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  background: #0d1117;
  color: #c9d1d9;
  font-family: Arial, sans-serif;
  padding: 20px;
}
h1, h2 {
  color: #58a6ff;
}
.card {
  background: #161b22;
  border: 1px solid #30363d;
  padding: 16px;
  margin-bottom: 20px;
  border-radius: 8px;
}
pre {
  background: #0d1117;
  border: 1px solid #30363d;
  padding: 12px;
  overflow-x: auto;
  border-radius: 6px;
}
.success { color: #3fb950; }
.fail { color: #f85149; }
.pending { color: #d29922; }
</style>
</head>

<body>
<h1>üöÄ SAAS-APP ‚Äî Codex + CI Monitoring Dashboard</h1>
<p>Real-time visualization of: PR Status, Codex Signals, CI Pipelines, TypeScript, Playwright, Prisma, and Branch Activity.</p>

<script>
const REPO = "garybayes/saas-app";
// (optional) Add token for higher rate limits ‚Äî NEVER commit with token
const GH_TOKEN = null; 

async function gh(url) {
  const headers = GH_TOKEN ? { Authorization: `Bearer ${GH_TOKEN}` } : {};
  const res = await fetch(url, { headers });
  return await res.json();
}
</script>

<!-- ==================== PR STATUS ==================== -->
<div class="card">
<h2>üîµ Active Pull Requests (Sprint 5)</h2>
<div id="prs">Loading...</div>
</div>

<script>
async function loadPRs() {
  const data = await gh(`https://api.github.com/repos/${REPO}/pulls?state=open`);
  if (!Array.isArray(data)) {
    document.getElementById("prs").innerHTML = "Error loading PRs.";
    return;
  }

  let html = "";
  data.forEach(pr => {
    html += `
      <div class="card">
        <h3>#${pr.number} ‚Äî ${pr.title}</h3>
        <p>Author: ${pr.user.login}</p>
        <p>Status: <span class="pending">Checking workflows...</span></p>
        <a href="${pr.html_url}" target="_blank">Open PR</a>
      </div>
    `;
  });

  document.getElementById("prs").innerHTML = html;
}
loadPRs();
</script>

<!-- ==================== WORKFLOW RUNS ==================== -->
<div class="card">
<h2>‚öôÔ∏è Latest Workflow Runs</h2>
<div id="workflows">Loading...</div>
</div>

<script>
async function loadWorkflows() {
  const data = await gh(`https://api.github.com/repos/${REPO}/actions/runs?per_page=10`);

  if (!data || !data.workflow_runs) {
    document.getElementById("workflows").innerHTML = "Error loading workflows.";
    return;
  }

  let html = "<table><tr><th>Name</th><th>Status</th><th>Conclusion</th><th>Event</th></tr>";
  data.workflow_runs.forEach(run => {
    html += `
      <tr>
        <td>${run.name}</td>
        <td>${run.status}</td>
        <td class="${run.conclusion === "success" ? "success" : "fail"}">${run.conclusion}</td>
        <td>${run.event}</td>
      </tr>
    `;
  });
  html += "</table>";

  document.getElementById("workflows").innerHTML = html;
}
loadWorkflows();
</script>

<!-- ==================== CODEX SIGNALS ==================== -->
<div class="card">
<h2>ü§ñ Codex Activity Signals</h2>
<div id="codex-signals">Loading...</div>
</div>

<script>
async function loadCodexSignals() {
  const badge = await gh(`https://raw.githubusercontent.com/${REPO}/main/.github/badges/codex-status.json`);

  let status = badge?.status ?? "unknown";
  let color = "pending";
  if (status === "active") color = "success";
  if (status === "error") color = "fail";

  document.getElementById("codex-signals").innerHTML = `
    <p>Codex Listener Status: <span class="${color}">${status.toUpperCase()}</span></p>
    <pre>${JSON.stringify(badge, null, 2)}</pre>
  `;
}
loadCodexSignals();
</script>

<!-- ==================== RECENT COMMITS ==================== -->
<div class="card">
<h2>üì° Recent Commits (All Branches)</h2>
<div id="commits">Loading...</div>
</div>

<script>
async function loadCommits() {
  const data = await gh(`https://api.github.com/repos/${REPO}/commits?per_page=20`);

  let html = "";
  data.forEach(c => {
    html += `
      <div>
        <strong>${c.commit.message}</strong><br/>
        <span>${c.commit.author.name} ‚Äî ${new Date(c.commit.author.date).toLocaleString()}</span><br/>
        <a href="${c.html_url}" target="_blank">View Commit</a>
        <hr/>
      </div>
    `;
  });

  document.getElementById("commits").innerHTML = html;
}
loadCommits();
</script>

<!-- ==================== AUTO REFRESH ==================== -->
<script>
setInterval(() => {
  loadPRs();
  loadWorkflows();
  loadCodexSignals();
  loadCommits();
}, 15000); // refresh every 15s
</script>

</body>
</html>
