# Codex Technical Overview v1.0  
_Last updated: {{DATE}}_

Codex is an **autonomous dual-track development assistant** embedded directly into this repository.  
Its purpose is to:

- monitor the repo for stale work or blockers  
- manage active sprint issues  
- run automated health checks  
- publish telemetry for observability  
- prompt human developers (you) only when interventions are needed  

This document explains **how Codex works**, its architecture, and how the workflows connect.

---

# 1. High-Level Architecture

Codex is composed of five main subsystems:

1. **Dual-Track Supervisor (Strategic Layer)**  
   - Processes sprint rules  
   - Maintains project hygiene  
   - Generates activity telemetry  
   - Ensures sprint + dashboard work stay aligned with roadmap

2. **Activity Engine (Tactical Layer)**  
   - Scans PRs, stale work, blockers  
   - Leaves reminders or escalations  
   - Ensures issues are linked to the Active Sprint milestone  

3. **Self-Test Engine**  
   - Creates an issue  
   - Adds it to the project  
   - Closes it  
   - Writes telemetry snapshot  
   - Validates the system plumbing end-to-end

4. **Telemetry Merge Engine**  
   - Consolidates supervisor + self-test data  
   - Outputs `codex-data.json` for the dashboard  

5. **Dashboard Deployment Engine**  
   - Handles UI assets under `/codex/dashboard/`  
   - Deploys to `gh-pages`  
   - Rebuilds dashboard only when source assets change  

---

# 2. Branch Strategy

Codex uses **two-branch isolation**:

| Branch | Description |
|--------|-------------|
| `main` | source code + workflows + dashboard source |
| `gh-pages` | telemetry + built dashboard assets |

Workflows that modify telemetry *must* check out the `gh-pages` branch to avoid upward drift in `main`.

---

# 3. Data Model

Codex maintains three canonical data sources:

### ✔ `supervisor-telemetry/latest.json`  
Generated by both the **Dual-Track Supervisor** and **Activity Engine**.

### ✔ `codex-selftest/latest.json`  
Generated by **Self-Test v4**.

### ✔ `codex-data.json`  
Unified dataset produced by the **Telemetry Merge Engine**.

Example:

```json
{
  "updated_at": "2025-11-28T02:10:12Z",
  "supervisor": { … },
  "selftest": { … }
}
4. Workflow Interactions
A. Supervisor → Telemetry Merge
Writes supervisor telemetry to gh-pages

Immediately triggers Telemetry Merge workflow

B. Self-Test → Telemetry Merge
Writes self-test telemetry

Also triggers Telemetry Merge

C. Telemetry Merge → Dashboard
Updates codex-data.json

Does not trigger re-deploy (Option A)

D. Dashboard Deploy (manual or source changes)
Re-generates HTML/JS/CSS

Publishes to gh-pages

5. Global Variables (central configuration)
Codex behavior is controlled by repository variables:

Variable	Purpose
CODEX_PROJECT_ID	GitHub Project V2 to manage
CODEX_ACTIVE_SPRINT	Determines which issues belong to main sprint
CODEX_DASHBOARD_MILESTONE	Determines which issues belong to dashboard sprint

No workflow code changes needed between sprints.

6. Safety Controls
Codex includes the following guardrails:

No changes to main made automatically

No destructive actions (closing PRs, deleting branches)

All writes occur on gh-pages only

Human approval remains required for merges

All workflow triggers are rate-limited

7. Telemetry Dashboard
URL:

perl
Copy code
https://<username>.github.io/<repo>/dashboard/
Displays:

Supervisor activity

Self-test cycles

Combined telemetry

Last update timestamps

Dashboard auto-updates on refresh (cache-link busting).

8. Extensibility Roadmap
Future enhancements include:

PR aging visualization

Workflow duration charts

Timeline heatmaps

Branch comparison

Failure clustering

Automatic Sprint rollovers

Codex “self-healing” routines

Stable improvements tracked in project board

9. Summary
Codex transforms this repository into an autonomous development assistant, capable of:

Tracking work

Evaluating sprint state

Running health checks

Consolidating signals

Publishing telemetry

Supporting human developers at scale

This Technical Overview is the foundation for the next phase: Codex V4+ autonomous evolution.

